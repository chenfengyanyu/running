---
title: ä½ å¯èƒ½ä¼šå¿½ç•¥çš„ Git æäº¤è§„èŒƒ
date: 2018-07-08 20:22:15
thumbnailImage: http://7xvi3w.com1.z0.glb.clouddn.com/gitcommit0.png
thumbnailImagePosition: left
tags: 
- git
- commit
comments: false
metaAlignment: center
categories: æŠ€æœ¯åšæ–‡
---
ä¸€ç›´æ˜¯ ESLint çš„å¿ å®ç”¨æˆ·ï¼Œæ·±çŸ¥è§„èŒƒçš„é‡è¦æ€§ã€‚ç„¶è€Œï¼Œåœ¨æ–°é¡¹ç›®äº¤æ¥ä¸­ï¼Œæˆ‘è¢« Git Commit è§„èŒƒé€¼ç–¯äº†ã€‚æ‰æ„è¯†åˆ°è‡ªå·±çš„ç–å¿½ï¼Œäºæ˜¯ä¾¿æœ‰äº†ä¸€æ¢ç©¶ç«Ÿçš„æƒ³æ³•ã€‚
<!-- more -->
#### ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è§„èŒƒï¼Ÿ
{% alert info %}
æ— è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œç¼–ç¨‹ä¹Ÿä¸€æ ·ã€‚
{% endalert %}
å¦‚æœä½ æœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œä»å§‹è‡³ç»ˆéƒ½æ˜¯è‡ªå·±å†™ï¼Œé‚£ä¹ˆä½ æƒ³æ€ä¹ˆå†™éƒ½å¯ä»¥ï¼Œæ²¡æœ‰äººå¯ä»¥å¹²é¢„ä½ ã€‚å¯æ˜¯å¦‚æœåœ¨å›¢é˜Ÿåä½œä¸­ï¼Œå¤§å®¶éƒ½å¼ æ‰¬ä¸ªæ€§ï¼Œé‚£ä¹ˆä»£ç å°†ä¼šæ˜¯ä¸€å›¢ç³Ÿï¼Œå¥½å¥½çš„é¡¹ç›®å°±è¢«ç³Ÿè·µäº†ã€‚ä¸ç®¡æ˜¯å¼€å‘è¿˜æ˜¯æ—¥åç»´æŠ¤ï¼Œéƒ½å°†æ˜¯ç¾éš¾ã€‚

è¿™æ—¶å€™ï¼Œæœ‰äººæå‡ºäº†ä½•ä¸ç»Ÿä¸€æ ‡å‡†ï¼Œå¤§å®¶éƒ½æŒ‰ç…§è¿™ä¸ªæ ‡å‡†æ¥ã€‚äºæ˜¯ `ESLint`ï¼Œ`JSHint` ç­‰ä»£ç å·¥å…·å¦‚é›¨åæ˜¥ç¬‹èˆ¬æ¶Œç°ï¼Œæˆä¸ºäº†é¡¹ç›®æ„å»ºçš„å¿…å¤‡è‰¯å“ã€‚

`Git Commit` è§„èŒƒå¯èƒ½å¹¶æ²¡æœ‰é‚£ä¹ˆå¤¸å¼ ï¼Œä½†å¦‚æœä½ åœ¨ç‰ˆæœ¬å›é€€çš„æ—¶å€™çœ‹åˆ°ä¸€å¤§æ®µç³Ÿå¿ƒçš„ `Commit`ï¼Œææ€•ä¼šæ‡Šæ¼ä¸å·²å§ã€‚æ‰€ä»¥ï¼Œä¸¥æ ¼éµå®ˆè§„èŒƒï¼Œåˆ©äººåˆ©å·±ã€‚

#### äºŒã€å…·ä½“è§„åˆ™
å…ˆæ¥çœ‹çœ‹å…¬å¼ï¼š
```bash
<type>(<scope>): <subject>
```
- type
  - ç”¨äºè¯´æ˜ `commit` çš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢7ä¸ªæ ‡è¯†ã€‚
  ```bash
  featï¼šæ–°åŠŸèƒ½ï¼ˆfeatureï¼‰
  fixï¼šä¿®è¡¥bug
  docsï¼šæ–‡æ¡£ï¼ˆdocumentationï¼‰
  styleï¼š æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰
  refactorï¼šé‡æ„ï¼ˆå³ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰
  testï¼šå¢åŠ æµ‹è¯•
  choreï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
  ```
- scope
  - ç”¨äºè¯´æ˜ `commit` å½±å“çš„èŒƒå›´ï¼Œæ¯”å¦‚æ•°æ®å±‚ã€æ§åˆ¶å±‚ã€è§†å›¾å±‚ç­‰ç­‰ï¼Œè§†é¡¹ç›®ä¸åŒè€Œä¸åŒã€‚
- subject
  - æ˜¯ `commit` ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡50ä¸ªå­—ç¬¦ã€‚
  ```
  1.ä»¥åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç¬¬ä¸€äººç§°ç°åœ¨æ—¶ï¼Œæ¯”å¦‚changeï¼Œè€Œä¸æ˜¯changedæˆ–changes
  2.ç¬¬ä¸€ä¸ªå­—æ¯å°å†™
  3.ç»“å°¾ä¸åŠ å¥å·ï¼ˆ.ï¼‰
  ```

è§„èŒƒå‚è€ƒè‡ªé˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ï¼š[Commit message å’Œ Change log ç¼–å†™æŒ‡å—](http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)ã€‚

#### ä¸‰ã€å¼‚å¸¸å¤„ç†
æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªå¼‚å¸¸æé†’ï¼š
```
INVALID COMMIT MSG: does not match "<type>(<scope>): <subject>" !
jartto:fix bug
```
è¿™é‡Œä¹‹æ‰€ä»¥æŠ¥å‡ºè¿™ä¸ªè­¦å‘Šï¼Œæ˜¯å› ä¸ºæˆ‘çš„æäº¤å‡ºç°äº†ä¸¤ä¸ªé—®é¢˜ï¼š
å…¶ä¸€ï¼Œä½¿ç”¨äº†è§„èŒƒå¤–çš„å…³é”®å­—ï¼›
å…¶äºŒï¼Œå¾ˆç»†èŠ‚çš„é—®é¢˜ï¼Œjarttoï¼šåå°‘äº†ç©ºæ ¼ï¼›

è¿™æ—¶å€™æˆ‘æ‰å›å¿†èµ·æ¥ï¼Œå½“æ—¶æäº¤ä¸€ç›´å¤±è´¥ï¼Œæƒ…æ€¥ä¹‹ä¸‹ç›´æ¥å¼ºåˆ¶æäº¤ï¼Œæ‰€ä»¥ä»¥åçš„æäº¤éƒ½ä¼šæŠ±å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚å¤§è‡´æ„æ€å°±æ˜¯ï¼š

{% alert danger %}
ä½ çš„ä¹‹å‰çš„ Commit ä¸åˆæ ¼ï½ä½ çš„ä¹‹å‰çš„ Commit ä¸åˆæ ¼ï½ä½ çš„ä¹‹å‰çš„ Commit ä¸åˆæ ¼
{% endalert %}

è¿™æ—¶å€™å°±å¾ˆçƒ¦äº†ï¼Œæˆ‘ä»¬åªèƒ½å»å°†ä¹‹å‰çš„é”™è¯¯ä¿®æ­£ï¼Œé‚£ä¹ˆå¦‚ä½•æ“ä½œå‘¢ï¼Ÿ

#### å››ã€å¦‚ä½•ä¿®æ”¹ä¹‹å‰çš„ commit ä¿¡æ¯ï¼Ÿ
å…¶å®å¹¶ä¸å¤æ‚ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™æ ·åš:
1ã€å°†å½“å‰åˆ†æ”¯æ— å…³çš„å·¥ä½œçŠ¶æ€è¿›è¡Œæš‚å­˜
```
git stash
```

2ã€å°† `HEAD` ç§»åŠ¨åˆ°éœ€è¦ä¿®æ”¹çš„ `commit` ä¸Š
```
git rebase 9633cf0919^ --interactive
```

3ã€æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„ `commit` ,å°†é¦–è¡Œçš„ `pick` æ”¹æˆ `edit` 
4ã€å¼€å§‹ç€æ‰‹è§£å†³ä½ çš„ `bug` 
5ã€ `git add` å°†æ”¹åŠ¨æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜ 
6ã€ `git commit â€“amend` è¿½åŠ æ”¹åŠ¨åˆ°æäº¤ 
7ã€`git rebase â€“continue` ç§»åŠ¨ `HEAD` å›æœ€æ–°çš„ `commit` 
8ã€æ¢å¤ä¹‹å‰çš„å·¥ä½œçŠ¶æ€
```
git stash pop
```
{% alert success %}
å¤§åŠŸå‘Šæˆï¼Œæ˜¯ä¸æ˜¯æƒ³æŠŠæ•´ä¸ª Commit éƒ½ä¿®æ”¹ä¸€éï¼Œé€ƒï½
{% endalert %}
æ­¤å¤„å‚è€ƒè‡ªï¼š[ä¿®æ”¹ Commit æ—¥å¿—å’Œå†…å®¹](https://www.aliyun.com/jiaocheng/125261.html)

#### äº”ã€é¡¹ç›®ä¸­ä½¿ç”¨
{% alert info %}
è¿™æ—¶å€™é—®é¢˜åˆæ¥äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘æäº¤çš„æ—¶å€™ä¼šæœ‰è­¦å‘Šï¼Œè¿™ä¸ªåˆæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ
{% endalert %}
è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€æ¬¾ `Node` æ’ä»¶ `validate-commit-msg` æ¥æ£€æŸ¥é¡¹ç›®ä¸­ `Commit message` æ˜¯å¦è§„èŒƒã€‚

1.é¦–å…ˆï¼Œå®‰è£…æ’ä»¶ï¼š
```
npm install --save-dev validate-commit-msg
```

2.ä½¿ç”¨æ–¹å¼ä¸€ï¼Œå»ºç«‹ `.vcmrc` æ–‡ä»¶ï¼š
```
{
  "types": ["feat", "fix", "docs", "style", "refactor", "perf", "test", "build", "ci", "chore", "revert"],
  "scope": {
    "required": false,
    "allowed": ["*"],
    "validate": false,
    "multiple": false
  },
  "warnOnFail": false,
  "maxSubjectLength": 100,
  "subjectPattern": ".+",
  "subjectPatternErrorMsg": "subject does not match subject pattern!",
  "helpMessage": "",
  "autoFix": false
}
```

3.ä½¿ç”¨æ–¹å¼äºŒï¼šå†™å…¥ `package.json`
```json
{
  "config": {
    "validate-commit-msg": {
      /* your config here */
    }
  }
}
```

4.å¯æ˜¯æˆ‘ä»¬å¦‚æœæƒ³è‡ªåŠ¨ä½¿ç”¨ [`ghooks`](https://www.npmjs.com/package/ghooks) é’©å­å‡½æ•°å‘¢ï¼Ÿ
```
{
  â€¦
  "config": {
    "ghooks": {
      "pre-commit": "gulp lint",
      "commit-msg": "validate-commit-msg",
      "pre-push": "make test",
      "post-merge": "npm install",
      "post-rewrite": "npm install",
      â€¦
    }
  }
  â€¦
}
```

{% alert info %}
åœ¨ `ghooks` ä¸­æˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œå½“ç„¶ä¸åªæ˜¯ `validate-commit-msg` å“¦ã€‚
{% endalert %}

æ›´å¤šç»†èŠ‚è¯·å‚è€ƒï¼š[validate-commit-msg](https://github.com/conventional-changelog-archived-repos/validate-commit-msg)

#### å…­ã€Commit è§„èŒƒçš„ä½œç”¨
1.æä¾›æ›´å¤šçš„ä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥ä¸å›é€€ï¼›
2.è¿‡æ»¤å…³é”®å­—ï¼Œè¿…é€Ÿå®šä½ï¼›
3.æ–¹ä¾¿ç”Ÿæˆæ–‡æ¡£ï¼›

#### ä¸ƒã€ç”Ÿæˆ Change log
æ­£å¦‚[ä¸Šæ–‡](http://jartto.wang/2018/07/08/git-commit/)æåˆ°çš„ç”Ÿæˆæ–‡æ¡£ï¼Œå¦‚æœæˆ‘ä»¬çš„æäº¤éƒ½æŒ‰ç…§è§„èŒƒçš„è¯ï¼Œé‚£å°±å¾ˆç®€å•äº†ã€‚ç”Ÿæˆçš„æ–‡æ¡£åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š
- New features
- Bug fixes
- Breaking changes.

æ¯ä¸ªéƒ¨åˆ†éƒ½ä¼šç½—åˆ—ç›¸å…³çš„ `commit` ï¼Œå¹¶ä¸”æœ‰æŒ‡å‘è¿™äº› `commit` çš„é“¾æ¥ã€‚å½“ç„¶ï¼Œç”Ÿæˆçš„æ–‡æ¡£å…è®¸æ‰‹åŠ¨ä¿®æ”¹ï¼Œæ‰€ä»¥å‘å¸ƒå‰ï¼Œä½ è¿˜å¯ä»¥æ·»åŠ å…¶ä»–å†…å®¹ã€‚

è¿™é‡Œéœ€è¦ä½¿ç”¨å·¥å…· [Conventional Changelog](https://github.com/conventional-changelog/conventional-changelog) ç”Ÿæˆ `Change log` ï¼š
```bash 
npm install -g conventional-changelog
cd jartto-domo
conventional-changelog -p angular -i CHANGELOG.md -w
```

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶å†™å…¥ `package.json` çš„ `scripts` å­—æ®µã€‚
```json
{
  "scripts": {
    "changelog": "conventional-changelog -p angular -i CHANGELOG.md -w -r 0"
  }
}
```

è¿™æ ·ï¼Œä½¿ç”¨èµ·æ¥å°±å¾ˆç®€å•äº†ï¼š
```bash
npm run changelog
```

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ‰€æœ‰çš„é—®é¢˜éƒ½ææ˜ç™½äº†ï¼ŒğŸ»Cheersï½

#### å…«ã€æ€»ç»“
çœ‹å®Œæ–‡ç« ï¼Œä½ è¿˜ä¼šå¦‚æ­¤æ”¾è¡ä¸ç¾å—ï¼Ÿä½ è¿˜ä¼šéšå¿ƒæ‰€æ¬²çš„ç¼–å†™ `Commit` å—ï¼Ÿä½ è¿˜ä¼šå¦‚æ­¤ `git commit -m "hello jartto" `æäº¤å—ï¼Ÿ

ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºä½¿ç”¨äº†é’©å­å‡½æ•°ï¼Œä½ æ²¡æœ‰æœºä¼šäº†ï¼Œå¦åˆ™å°†æ˜¯æ— ç©·æ— å°½çš„æ¢å¤ `Commit`ã€‚è¿™å€’å¯ä»¥å…»æˆè‰¯å¥½çš„æäº¤ä¹ æƒ¯ï¼ŒğŸ™ˆï½
