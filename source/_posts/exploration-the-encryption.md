---
title: 初探加密算法
date: 2017-12-03 18:53:33
thumbnailImage: http://7xvi3w.com1.z0.glb.clouddn.com/encrtption0.png
thumbnailImagePosition: left
tags: 
- encrypt
- 加密
- 算法
comments: false
metaAlignment: center
categories: 技术博文 
---
最近同事做了一次加密算法的分享，感觉自己对这方面的认知还有待提升，这篇文章算是先入门吧，多学点知识总归是好的。
<!-- more -->
#### 一、为什么要加密？
加密可以保护我们的数据。无论数据是正存放在我们自己的计算机上，还是位于数据中心，或者正在通过互联网传送的途中，加密都可以提供防护。

加密可以保护我们的聊天，不管是视频、语音还是文字。加密可以保护我们的隐私，可以隐藏我们的踪迹，甚至有时候，它会保护我们的生命－这种保护是攸关我们每个人的。

{% alert info %}
默认情况下，加密应该启用，而不是只有当你在做一些你认为值得保护的事情时才启用。
{% endalert %}

如果你觉得这些理由还不足以说服你，那么请看这篇文章：[Why We Encrypt](https://www.schneier.com/blog/archives/2015/06/why_we_encrypt.html)

#### 二、常见的加密算法
1.对称加密
{% alert success %}
所谓对称，就是采用这种加密方法的双方使用方式用同样的密钥进行加密和解密。密钥是控制加密及解密过程的指令。算法是一组规则，规定如何进行加密和解密。
{% endalert %}
![对称加密](http://7xvi3w.com1.z0.glb.clouddn.com/encrtption1.png)

就拿[百度百科](https://baike.baidu.com/item/对称加密/2152944?fr=aladdin)中这个例子来说吧：
甲和乙是一对生意搭档，他们住在不同的城市。由于生意上的需要，他们经常会相互之间邮寄重要的货物。为了保证货物的安全，他们商定制作一个保险盒，将物品放入其中。他们打造了两把相同的钥匙分别保管，以便在收到包裹时用这个钥匙打开保险盒，以及在邮寄货物前用这把钥匙锁上保险盒。

上面是一个将重要资源安全传递到目的地的传统方式，只要甲乙小心保管好钥匙，那么就算有人得到保险盒，也无法打开。

这个思想被用到了现代计算机通信的信息加密中。在对称加密中，数据发送方将明文（原始数据）和加密密钥一起经过特殊加密算法处理后，使其变成复杂的加密密文发送出去。接收方收到密文后，若想解读原文，则需要使用加密密钥及相同算法的逆算法对密文进行解密，才能使其恢复成可读明文。
{% alert success %}
在对称加密算法中，使用的密钥只有一个，发收信双方都使用这个密钥对数据进行加密和解密。
{% endalert %}

在对称加密算法中常用的算法有：DES、3DES、TDEA、Blowfish、RC2、RC4、RC5、IDEA、SKIPJACK、AES 等。

优缺点：
- 优点：算法公开、计算量小、加密速度快、加密效率高；
- 缺点：在数据传送前，发送方和接收方必须商定好秘钥，然后使双方都能保存好秘钥。其次如果一方的秘钥被泄露，那么加密信息也就不安全了。另外，每对用户每次使用对称加密算法时，都需要使用其他人不知道的唯一秘钥，这会使得收、发双方所拥有的钥匙数量巨大，密钥管理成为双方的负担。

2.非对称加密
非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。

还是举个[例子](http://blog.csdn.net/cscrazybing/article/details/47111099)来说明：
如果企业中有 n 个用户，企业需要生成 n 对密钥，并分发 n 个公钥。由于公钥是可以公开的，用户只要保管好自己的私钥即可(企业分发后一般保存的是私钥,用户拿的是公钥)，因此加密密钥的分发将变得十分简单。同时，由于每个用户的私钥是唯一的，其他用户除了可以可以通过信息发送者的公钥来验证信息的来源是否真实，还可以确保发送者无法否认曾发送过该信息。

常见的非对称加密算法有：RSA、ECC（移动设备用）、Diffie-Hellman、El Gamal、DSA（数字签名用）。

优缺点：
- 优点：非对称加密算法的保密性比较好，它消除了最终用户交换密钥的需要；
- 缺点：但加密和解密花费时间长、速度慢，它不适合于对文件加密而只适用于对少量数据进行加密；

3.Hash 加密（ MD5 加密是典型应用）
`Hash` 算法特别的地方在于它是一种单向算法，用户可以通过 `Hash` 算法对目标信息生成一段特定长度的唯一的 `Hash` 值，却不能通过这个 `Hash` 值重新获得目标信息。因此 `Hash` 算法常用在不可还原的密码存储、信息完整性校验等。

常见的Hash算法有 MD2、MD4、MD5、HAVAL、SHA ；

深入了解请移步：
- [加密](https://github.com/hello2dj/blog/blob/master/加密.md)
- [对称加密和非对称加密介绍和区别](http://blog.csdn.net/cscrazybing/article/details/47111099)

#### 三、SSL/TLS 协议
1.SSL协议的握手过程
{% alert success %}
开始加密通信之前，客户端和服务器首先必须建立连接和交换参数，这个过程叫做握手（handshake）。
{% endalert %}
用[阮一峰老师的举例](http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html)来说明一下，握手阶段分成五步：
第一步，爱丽丝给出协议版本号、一个客户端生成的随机数（Client random），以及客户端支持的加密方法。
第二步，鲍勃确认双方使用的加密方法，并给出数字证书、以及一个服务器生成的随机数（Server random）。
第三步，爱丽丝确认数字证书有效，然后生成一个新的随机数（Premaster secret），并使用数字证书中的公钥，加密这个随机数，发给鲍勃。
第四步，鲍勃使用自己的私钥，获取爱丽丝发来的随机数（即Premaster secret）。
第五步，爱丽丝和鲍勃根据约定的加密方法，使用前面的三个随机数，生成"对话密钥"（session key），用来加密接下来的整个对话过程。

握手阶段有三点需要注意：
- 生成对话密钥一共需要三个随机数。
- 握手之后的对话使用"对话密钥"加密（对称加密），服务器的公钥和私钥只用于加密和解密"对话密钥"（非对称加密），无其他作用。
- 服务器公钥放在服务器的数字证书之中。
2.DH 算法的握手阶段
整个握手阶段都不加密（也没法加密），都是明文的。因此，如果有人窃听通信，他可以知道双方选择的加密方法，以及三个随机数中的两个。整个通话的安全，只取决于第三个随机数（Premaster secret）能不能被破解。

3.Session 的恢复
握手阶段用来建立 SSL 连接。如果出于某种原因，对话中断，就需要重新握手。这时有两种方法可以恢复原来的 session：一种叫做 session ID，另一种叫做 session ticket 。

这里大概说一下思路，查看详情：[图解SSL/TLS协议](http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html)

#### 四、数字签名
数字证书和数字签名的原理简单来说数字签名就是传输信息的摘要，数字证书就是 CA 用自己的私钥把你的公钥及其他信息加密后生成内容, 即 CA 用自己的私钥来给你的公钥做数字签名。
{% alert info %}
为什么会提到数字签名？这是因为：非对称加密的典型应用是数字签名。
{% endalert %}

数字签名的作用：
- 能确定消息的不可抵赖性，因为他人假冒不了发送方的私钥签名。发送方是用自己的私钥对信息进行加密的，只有使用发送方的公钥才能解密。
- 数字签名能保障消息的完整性。一次数字签名采用一个特定的哈希函数，它对不同文件产生的数字摘要的值也是不相同的

数字证书的作用:
- 不可抵赖性
- 消息的完整性
- 身份认证

很形象的一个[例子](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)：
1.鲍勃有两把钥匙，一把是公钥，另一把是私钥。
2.鲍勃把公钥送给他的朋友们----帕蒂、道格、苏珊----每人一把。
3.苏珊要给鲍勃写一封保密的信。她写完后用鲍勃的公钥加密，就可以达到保密的效果。
4.鲍勃收信后，用私钥解密，就看到了信件内容。这里要强调的是，只要鲍勃的私钥不泄露，这封信就是安全的，即使落在别人手里，也无法解密。
5.鲍勃给苏珊回信，决定采用"数字签名"。他写完后先用 Hash 函数，生成信件的摘要（digest）。
6.然后，鲍勃使用私钥，对这个摘要加密，生成"数字签名"（signature）。
7.鲍勃将这个签名，附在信件下面，一起发给苏珊。
8.苏珊收信后，取下数字签名，用鲍勃的公钥解密，得到信件的摘要。由此证明，这封信确实是鲍勃发出的。
9.苏珊再对信件本身使用 Hash 函数，将得到的结果，与上一步得到的摘要进行对比。如果两者一致，就证明这封信未被修改过。
10.复杂的情况出现了。道格想欺骗苏珊，他偷偷使用了苏珊的电脑，用自己的公钥换走了鲍勃的公钥。此时，苏珊实际拥有的是道格的公钥，但是还以为这是鲍勃的公钥。因此，道格就可以冒充鲍勃，用自己的私钥做成"数字签名"，写信给苏珊，让苏珊用假的鲍勃公钥进行解密。
11.后来，苏珊感觉不对劲，发现自己无法确定公钥是否真的属于鲍勃。她想到了一个办法，要求鲍勃去找"证书中心"（certificate authority，简称 CA ），为公钥做认证。证书中心用自己的私钥，对鲍勃的公钥和一些相关信息一起加密，生成"数字证书"（Digital Certificate）。
12.鲍勃拿到数字证书以后，就可以放心了。以后再给苏珊写信，只要在签名的同时，再附上数字证书就行了。
13.苏珊收信后，用 CA 的公钥解开数字证书，就可以拿到鲍勃真实的公钥了，然后就能证明"数字签名"是否真的是鲍勃签的。

深入了解，请查看阮一峰老师的文章：[数字签名是什么？](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)


#### 六、CA（Certificate Authority） 数字证书认证机构
{% alert info %}
负责发放和管理数字证书的权威机构，承担公钥体系中公钥的合法性检验的责任。
{% endalert %}

CA 是证书的签发机构，它是 PKI 的核心。CA 是负责签发证书、认证证书、管理已颁发证书的机关。它要制定政策和具体步骤来验证、识别用户身份，并对用户证书进行签名，以确保证书持有者的身份和公钥的拥有权。

CA 也拥有一个证书（内含公钥）和私钥。网上的公众用户通过验证 CA 的签字从而信任 CA ，任何人都可以得到 CA 的证书（含公钥），用以验证它所签发的证书。

如果用户想得到一份属于自己的证书，他应先向 CA 提出申请。在 CA 判明申请者的身份后，便为他分配一个公钥，并且 CA 将该公钥与申请者的身份信息绑在一起，并为之签字后，便形成证书发给申请者。

如果一个用户想鉴别另一个证书的真伪，他就用 CA 的公钥对那个证书上的签字进行验证，一旦验证通过，该证书就被认为是有效的

#### 七、扩展阅读
- [hello2dj 加密](https://github.com/hello2dj/blog/blob/master/加密.md)
- [对称加密和非对称加密介绍和区别](http://blog.csdn.net/cscrazybing/article/details/47111099)
- [数字签名是什么？](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)
- [对称加密](https://baike.baidu.com/item/对称加密/2152944?fr=aladdin)
- [图解 SSL/TLS 协议](http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html)




